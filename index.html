<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Leo Shabarov, yes THE Leo Shabarov</title>

  <meta name="description" content="Join now, as Leo Shabarov explores and learns about the true nature of reality">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/notes/manifest.json">
  <meta name="theme-color" content="#070913">

  <!-- Person JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Leo Shabarov",
    "url": "https://leoshabarov.com/",
    "image": "https://leoshabarov.com/apple-touch-icon.png",
    "sameAs": [
      "https://www.youtube.com/@leoshabarov",
      "https://www.instagram.com/leoshabarov"
    ]
  }
  </script>

  <!-- WebSite JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Leo Shabarov",
    "url": "https://leoshabarov.com/",
    "publisher": { "@type": "Person", "name": "Leo Shabarov" }
  }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">

  <!-- Global + page CSS -->
  <link rel="stylesheet" href="/assets/theme.css?v=3">
  <link rel="stylesheet" href="/assets/site.css?v=3">

  <!-- OPTIONAL: tiny page-specific tweaks (make sure comments close!) -->
  <style>
    /* Page-specific tweaks only */
    /* (leave empty or add small overrides here) */
  </style>

  <!-- Normal JS belongs in a normal <script>, not ld+json -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const m = document.querySelector('meta[name="theme-color"]');
      if (m) {
        const bg = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() || '#0a0d16';
        m.setAttribute('content', bg);
      }
    });
  </script>
</head>
<body>
<header class="header">
    <div class="wrap nav">
      <a class="brand" href="#top">
        <div class="logo">
          <svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 2l2.8 6.6L22 9.3l-5 4.6L18.6 21 12 17.7 5.4 21 7 13.9 2 9.3l7.2-.7L12 2z" fill="white"/></svg>
        </div>
        <span class="title">Leo Shabarov</span>
      </a>
      <div class="links">
        <a href="#about">About</a>
        <a href="#courses">Courses</a>
        <a href="/notes/">Notebook</a>
        <a href="#desmos">Desmos</a>
        <a href="#contact">Contact</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="top">
      <div class="hgrid">
        <div>
          <h1 class="h1">Math does not lie.</h1>
          <p class="lead">Until it does.</p>
          <div class="actions">
            <a class="iconbtn" href="https://www.youtube.com/@leoshabarov" target="_blank" aria-label="YouTube">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M23 12s0-3.3-.42-4.9c-.24-.9-.95-1.6-1.85-1.85C18.98 4.92 12 4.92 12 4.92s-6.98 0-8.73.33c-.9.25-1.61.96-1.85 1.86C1 8.7 1 12 1 12s0 3.3.42 4.9c.24.9.95 1.6 1.85 1.85 1.75.33 8.73.33 8.73.33s6.98 0 8.73-.33c.9-.25 1.61-.95 1.85-1.85.42-1.6.42-4.9.42-4.9z" fill="#ff0033"/><path d="M9.75 8.75v6.5L15.5 12l-5.75-3.25z" fill="#fff"/></svg>
            </a>
            <a class="iconbtn" href="https://www.instagram.com/leoshabarov/" target="_blank" aria-label="Instagram">
              <svg width="22" height="22" viewBox="0 0 24 24"><defs><linearGradient id="g" x1="0" x2="24" y1="0" y2="24"><stop stop-color="#feda75"/><stop offset=".3" stop-color="#fa7e1e"/><stop offset=".6" stop-color="#d62976"/><stop offset="1" stop-color="#962fbf"/></linearGradient></defs><rect x="4" y="4" width="16" height="16" rx="5" fill="url(#g)"/><circle cx="12" cy="12" r="3.5" fill="#fff"/><circle cx="17.5" cy="6.5" r="1.2" fill="#fff"/></svg>
            </a>
          </div>
        </div>
        <div class="portrait"><img src="images/portrait.gif" alt="Portrait of Leo"></div>
      </div>
    </section>

    <section id="about" class="section reveal">
      <h2>About</h2>
      <p class="lead">Seventeen-year-old mathematician following whatever I'm interested in. I think a lot about how strange it is that everyone lives in their own subjective reality. Hate AI, worried about the impending future. I guess everyone is right</p>
    </section>

    <section id="courses" class="section reveal">
      <h2>Courses I’ve finished</h2>
      <div class="rail" id="rail"><div class="track" id="track"></div></div>
      <div class="course-info">
        <div class="course-panel" id="coursePanel">
          <div>
            <div class="course-title" id="courseTitle"></div>
            <div class="course-desc" id="courseDesc"></div>
                      </div>
          <div class="preview"><canvas id="courseCanvas"></canvas></div>
        </div>
      </div>
      <div class="center"><div class="pill">Currently learning: Complex Analysis</div></div>
    </section>

    <section id="desmos" class="section reveal">
      <h2>Desmos Gallery</h2>
      <div class="grid">
        <div class="card">
          <a href="https://www.desmos.com/calculator/be7a168fbe" target="_blank" rel="noopener">
            <img src="images/unit_circle.png" alt="Unit Circle Visualization">
            Unit Circle Visualization
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/14a5e1c18a" target="_blank" rel="noopener">
            <img src="images/stinky.png" alt="Animation Preview">
            Animation Preview
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/3666017f8b" target="_blank" rel="noopener">
            <img src="images/3d_cube.png" alt="3D Cube">
            3D Cube
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/4eq953wrtv" target="_blank" rel="noopener">
            <img src="images/leo_bouncing.png" alt="Leo Bouncing">
            Leo Bouncing
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/hdjkxeiwnn" target="_blank" rel="noopener">
            <img src="images/desmos_guide.png" alt="Desmos Guide">
            Desmos Guide
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/zii17ill0v" target="_blank" rel="noopener">
            <img src="images/normal_distribution.png" alt="Normal Distribution">
            Normal Distribution
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/amqw6j7dzi" target="_blank" rel="noopener">
            <img src="images/mandelbrot.png" alt="Mandelbrot Set Visual">
            Mandelbrot Set Visual
          </a>
        </div>
        <div class="card">
          <a href="https://www.desmos.com/calculator/usn7c865bh" target="_blank" rel="noopener">
            <img src="images/continuous.png" alt="Continuous Visualization">
            Continuous Visualization
          </a>
        </div>
        <div class="card">
          <a href="/droste/">
            <img src="images/droste_preview.png" alt="Droste Effect tool preview">
            Droste Effect
          </a>
      </div>
      </div>
    </section>

    <section id="notebook" class="section reveal">
      <h2>Notebook</h2>
      <p class="lead">Me rambling.</p>
      <div class="notebook">
        <div class="note">
          <a href="/notes/bases-and-adics.html">
            <span>Bases and Adics</span>
            <span class="badge">new</span>
          </a>
        </div>
      </div>
    </section>

    <section id="contact" class="section reveal">
      <h2>Contact</h2>
      <div class="grid"><div class="card"><a href="mailto:hello@leoshabarov.com">Email</a></div></div>
    </section>
  </main>

  <footer class="wrap">
    <div class="nav" style="padding:0">
      <a class="brand" href="#top">
        <div class="logo"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 2l2.8 6.6L22 9.3l-5 4.6L18.6 21 12 17.7 5.4 21 7 13.9 2 9.3l7.2-.7L12 2z" fill="white"/></svg></div>
        <span class="title">Leo Shabarov</span>
      </a>
      <div style="color:#7f93c9">© <span id="year"></span></div>
    </div>
  </footer>

  <div class="cursor" id="cursor"></div>

  <!-- Shared background + hue rotation, centralized -->
  <script defer src="/assets/site.js"></script>

  <!-- Page-specific JS (no tiles/background logic here) -->
  <script>
  const rail=document.getElementById('rail');
  const track=document.getElementById('track');
  const courses=['Algebra I','Geometry','Algebra II','Pre-Calc','Calculus I','Calculus II','Calculus III','ODE','Linear Algebra','Discrete Math','Real Analysis'];

  function oneRow(){
    const d=document.createElement('div');
    d.style.display='flex'; d.style.gap='18px';
    for(const c of courses){
      const el=document.createElement('div');
      el.className='chip'; el.textContent=c; el.dataset.course=c; d.appendChild(el);
    }
    return d;
  }
  const loops=4; for(let i=0;i<loops;i++) track.appendChild(oneRow());

  let loopWidth=0; function measureLoop(){
    const first=track.firstElementChild; loopWidth=first?first.getBoundingClientRect().width+18:0
  }
  setTimeout(measureLoop,0);

  rail.addEventListener('scroll',()=>{
    if(!rail.classList.contains('paused')) return;
    if(loopWidth<=0) return;
    const two=loopWidth*2;
    if(rail.scrollLeft>two) rail.scrollLeft-=loopWidth;
    else if(rail.scrollLeft<0) rail.scrollLeft+=loopWidth
  });

  let isDown=false,startX=0,scrollL=0;
  rail.addEventListener('pointerdown',e=>{
    if(!rail.classList.contains('paused'))return;
    isDown=true; rail.setPointerCapture(e.pointerId); startX=e.clientX; scrollL=rail.scrollLeft
  });
  rail.addEventListener('pointermove',e=>{
    if(!isDown)return; rail.scrollLeft=scrollL-(e.clientX-startX)
  });
  rail.addEventListener('pointerup',()=>{isDown=false});
  rail.addEventListener('wheel',e=>{ if(rail.classList.contains('paused')) rail.scrollLeft+=e.deltaY });

  const panel=document.getElementById('coursePanel');
  const titleEl=document.getElementById('courseTitle');
  const descEl=document.getElementById('courseDesc');
  const canvas=document.getElementById('courseCanvas');
  const ctx=canvas.getContext('2d');
  const preview=document.querySelector('.preview');
  let animRAF=null;

  const courseInfo={
    'Algebra I':{d:'Linear equations and inequalities, slope and intercept, systems, and function notation.',a:'alg1'},
    'Geometry':{d:'Proofs, congruence and similarity, circles, coordinate geometry, and basic right triangle trigonometry.',a:'geom'},
    'Algebra II':{d:'Quadratics and polynomials, rational expressions, complex numbers, exponentials and logarithms, and sequences.',a:'alg2'},
    'Pre-Calc':{d:'Unit circle and identities, inverse trig, transformations, polar and parametric curves, and vectors.',a:'precalc'},
    'Calculus I':{d:'Limits, derivatives, related rates, optimization, and the first look at integrals as area and accumulation.',a:'calc1'},
    'Calculus II':{d:'Integration techniques, applications of integrals, infinite sequences and series, and polar and parametric calculus.',a:'calc2'},
    'Calculus III':{d:'Vectors and 3D geometry, partial derivatives, multiple integrals, and vector calculus ideas like line and surface integrals.',a:'calc3'},
    'ODE':{d:'First and second order differential equations, slope fields, modeling, equilibrium, and qualitative behavior of solutions.',a:'ode'},
    'Linear Algebra':{d:'Vector spaces, linear transformations, matrices, determinants, eigenvalues and eigenvectors, and diagonalization.',a:'linalg'},
    'Discrete Math':{d:'Logic and proof, induction, counting, modular arithmetic, recursion, graphs, and basic algorithms.',a:'discrete'},
    'Real Analysis':{d:'Epsilon delta definitions, limits and continuity, sequences and series convergence, and the rigor behind calculus.',a:'real'}
  };

  function resizeCanvas(){
    const dpr=Math.min(devicePixelRatio||1,2);
    const cssW=preview.clientWidth||600;
    const tallPhone=matchMedia('(max-width: 480px) and (orientation: portrait)').matches;
    const cssH=tallPhone?Math.max(260,Math.min(500,cssW*0.95)):Math.max(240,Math.min(360,cssW*0.70));
    canvas.width=Math.floor(cssW*dpr); canvas.height=Math.floor(cssH*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  function axes(W,H){
    ctx.save(); ctx.strokeStyle='rgba(255,255,255,.16)'; ctx.lineWidth=1;
    ctx.beginPath();
    for(let x=0;x<=W;x+=20){ctx.moveTo(x,0);ctx.lineTo(x,H)}
    for(let y=0;y<=H;y+=20){ctx.moveTo(0,y);ctx.lineTo(W,y)}
    ctx.stroke(); ctx.restore();
  }
  function showPanel(name){
    const info=courseInfo[name];
    titleEl.textContent=(name==='ODE')?'Ordinary Differential Equations':name;
    descEl.textContent=info.d;
    panel.classList.add('show'); rail.classList.add('paused');
    document.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active',x.dataset.course===name));
    requestAnimationFrame(()=>{resizeCanvas(); startAnim(info.a)});
  }
  function hidePanel(){
    panel.classList.remove('show'); rail.classList.remove('paused');
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    if(animRAF){cancelAnimationFrame(animRAF); animRAF=null}
  }
  document.querySelectorAll('.chip').forEach(ch=>ch.addEventListener('mouseenter',()=>showPanel(ch.dataset.course)));
  panel.addEventListener('mouseleave',hidePanel);

  function startAnim(type){
    if(animRAF){cancelAnimationFrame(animRAF); animRAF=null}
    let t=0;
    function draw(){
      t++;
      const W=preview.clientWidth||600, H=canvas.height/(Math.min(devicePixelRatio||1,2))||260;
      ctx.clearRect(0,0,W,H); axes(W,H); ctx.save();
      const tallPhone=matchMedia('(max-width: 480px) and (orientation: portrait)').matches;
      ctx.translate(W/2+(tallPhone?6:24),H/2); if(tallPhone) ctx.scale(0.92,0.92);
      ctx.lineWidth=2.5; ctx.strokeStyle='rgba(142,197,255,.95)';

     
      if(type==='alg1'){ 
        const m=0.25+0.55*Math.abs(Math.sin(t*0.008)); const b=18*Math.sin(t*0.006);
        ctx.beginPath(); for(let x=-W;x<=W;x+=2){const y=-(m*x+b); x===-W?ctx.moveTo(x,y):ctx.lineTo(x,y)} ctx.stroke();
        const x0=-120, y0=-(m*x0+b), dx=130, dy=-(m*dx);
        ctx.setLineDash([6,6]); ctx.strokeStyle='rgba(255,255,255,.5)';
        ctx.beginPath(); ctx.moveTo(x0,y0); ctx.lineTo(x0+dx,y0); ctx.moveTo(x0+dx,y0); ctx.lineTo(x0+dx,y0+dy); ctx.stroke(); ctx.setLineDash([]);
        ctx.fillStyle='rgba(200,220,255,.95)'; ctx.font='12px Space Grotesk'; ctx.fillText('Δx',x0+dx/2-8,y0-6); ctx.fillText('Δy',x0+dx+6,y0+dy/2);
      }
      
      if(type==='geom'){
      function tri(s,offx,offy,rot,col){
        const A=[-60*s,-40*s],B=[70*s,-20*s],C=[-10*s,60*s];
        const R=(p)=>{const c=Math.cos(rot),d=Math.sin(rot);return [c*p[0]-d*p[1]+offx,d*p[0]+c*p[1]+offy]};
        const P=[R(A),R(B),R(C)];
        ctx.strokeStyle=col;ctx.beginPath();ctx.moveTo(P[0][0],P[0][1]);ctx.lineTo(P[1][0],P[1][1]);ctx.lineTo(P[2][0],P[2][1]);ctx.closePath();ctx.stroke();
        function arc(p,q,r){ctx.beginPath();ctx.arc(p[0],p[1],12*s,Math.atan2(q[1]-p[1],q[0]-p[0]),Math.atan2(r[1]-p[1],r[0]-p[0]));ctx.stroke()}
        ctx.lineWidth=2;arc(P[0],P[1],P[2]);arc(P[1],P[2],P[0]);arc(P[2],P[0],P[1]);ctx.lineWidth=2.5;return P
      }
      const leftX=-160, leftY=10, baseScale=1;
      const animDur=200, holdDur=90, cyc=animDur+holdDur, u=t%cyc, phase=u<animDur?u/animDur:1;
      const moveRight=180, s=baseScale*(1+phase*0.5), x=leftX+phase*moveRight+20;
      const A=tri(baseScale,leftX+20,leftY,0,'rgba(142,197,255,.95)');
      const Bp=tri(s,x,leftY,0,'rgba(170,160,255,.95)');
      ctx.setLineDash([5,7]);ctx.strokeStyle='rgba(255,255,255,.45)';ctx.beginPath();
      ctx.moveTo(A[0][0],A[0][1]);ctx.lineTo(Bp[0][0],Bp[0][1]);
      ctx.moveTo(A[1][0],A[1][1]);ctx.lineTo(Bp[1][0],Bp[1][1]);
      ctx.moveTo(A[2][0],A[2][1]);ctx.lineTo(Bp[2][0],Bp[2][1]);
      ctx.stroke();ctx.setLineDash([]);
    }

    if(type==='alg2'){
      function f(x){return Math.pow(x,5)-4*Math.pow(x,3)+3*x}
      ctx.beginPath();for(let xp=-W/2;xp<W/2;xp+=2){const x=xp/60;const y=f(x);const sy=-y*20; xp===-W/2?ctx.moveTo(xp,sy):ctx.lineTo(xp,sy)}ctx.stroke();
      const roots=[-Math.sqrt(3)*60,-60,0,60,Math.sqrt(3)*60], idx=Math.floor((t/60)%roots.length);
      for(let i=0;i<roots.length;i++){ctx.beginPath();ctx.fillStyle=i<=idx?'rgba(255,200,120,1)':'rgba(200,200,220,.5)';ctx.arc(roots[i],0,5,0,6.283);ctx.fill()}
    }

    if (type === 'precalc') {
  // Persistent state for a clean scrolling trace
  if (!window._precalc) window._precalc = { sin: [], cos: [], a: 0 };
  const S = window._precalc;

  // Layout (we are already in the translated coordinate system)
  const R = Math.max(52, Math.min(92, Math.min(W, H) * 0.22));
  const circleCX = -W * 0.32;
  const circleCY = 0;

  const gx0 = -W * 0.02;     // graph left
  const gx1 =  W * 0.50;     // graph right
  const gy0 = -H * 0.30;     // graph top
  const gy1 =  H * 0.30;     // graph bottom
  const gMidY = (gy0 + gy1) / 2;
  const amp = (gy1 - gy0) * 0.42;

  // Advance angle
  S.a = (S.a + 0.035) % (Math.PI * 2);
  const a = S.a;

  // Circle point + projections
  const c = Math.cos(a);
  const s = Math.sin(a);
  const px = circleCX + R * c;
  const py = circleCY - R * s; // minus so positive sin goes up

  // Push history for traces (fixed length)
  const N = Math.max(140, Math.min(240, Math.floor((gx1 - gx0) / 3)));
  S.sin.push(s);
  S.cos.push(c);
  if (S.sin.length > N) S.sin.shift();
  if (S.cos.length > N) S.cos.shift();

  // --- Draw: unit circle + axes ---
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,.55)';
  ctx.lineWidth = 1.5;

  // Circle axes
  ctx.beginPath();
  ctx.moveTo(circleCX - R - 18, circleCY);
  ctx.lineTo(circleCX + R + 18, circleCY);
  ctx.moveTo(circleCX, circleCY - R - 18);
  ctx.lineTo(circleCX, circleCY + R + 18);
  ctx.stroke();

  // Circle
  ctx.strokeStyle = 'rgba(142,197,255,.95)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  ctx.arc(circleCX, circleCY, R, 0, Math.PI * 2);
  ctx.stroke();

  // Radius
  ctx.setLineDash([6, 6]);
  ctx.strokeStyle = 'rgba(255,255,255,.45)';
  ctx.beginPath();
  ctx.moveTo(circleCX, circleCY);
  ctx.lineTo(px, py);
  ctx.stroke();
  ctx.setLineDash([]);

  // Projections to axes
  const projX = circleCX + R * c;
  const projY = circleCY - R * s;

  // Vertical projection to x-axis (cos)
  ctx.setLineDash([4, 6]);
  ctx.strokeStyle = 'rgba(120,220,255,.55)';
  ctx.beginPath();
  ctx.moveTo(projX, projY);
  ctx.lineTo(projX, circleCY);
  ctx.stroke();

  // Horizontal projection to y-axis (sin)
  ctx.strokeStyle = 'rgba(170,160,255,.55)';
  ctx.beginPath();
  ctx.moveTo(projX, projY);
  ctx.lineTo(circleCX, projY);
  ctx.stroke();
  ctx.setLineDash([]);

  // Points
  ctx.fillStyle = 'rgba(200,220,255,.95)';
  ctx.beginPath(); ctx.arc(px, py, 4.2, 0, Math.PI * 2); ctx.fill();

  ctx.fillStyle = 'rgba(120,220,255,.95)'; // cos point on x-axis
  ctx.beginPath(); ctx.arc(projX, circleCY, 3.6, 0, Math.PI * 2); ctx.fill();

  ctx.fillStyle = 'rgba(170,160,255,.95)'; // sin point on y-axis
  ctx.beginPath(); ctx.arc(circleCX, projY, 3.6, 0, Math.PI * 2); ctx.fill();

  // Labels
  ctx.fillStyle = 'rgba(255,255,255,.70)';
  ctx.font = '12px Space Grotesk';
  ctx.fillText('cos', circleCX + R + 14, circleCY + 4);
  ctx.fillText('sin', circleCX - 18, circleCY - R - 10);

  ctx.restore();

  // --- Draw: graph axes ---
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,.45)';
  ctx.lineWidth = 1.5;

  // Graph box axes
  ctx.beginPath();
  ctx.moveTo(gx0, gMidY); ctx.lineTo(gx1, gMidY);  // x-axis
  ctx.moveTo(gx0, gy0);   ctx.lineTo(gx0, gy1);    // y-axis
  ctx.stroke();

  // --- Draw: traces (sin + cos) ---
  const dx = (gx1 - gx0) / (N - 1);

  // cos trace
  ctx.strokeStyle = 'rgba(120,220,255,.90)';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  for (let i = 0; i < S.cos.length; i++) {
    const x = gx0 + i * dx;
    const y = gMidY - S.cos[i] * amp;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  }
  ctx.stroke();

  // sin trace
  ctx.strokeStyle = 'rgba(170,160,255,.90)';
  ctx.beginPath();
  for (let i = 0; i < S.sin.length; i++) {
    const x = gx0 + i * dx;
    const y = gMidY - S.sin[i] * amp;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  }
  ctx.stroke();

  // Current time marker and linking guides
  const xNow = gx0 + (S.sin.length - 1) * dx;
  const ySinNow = gMidY - s * amp;
  const yCosNow = gMidY - c * amp;

  ctx.setLineDash([4, 6]);
  ctx.strokeStyle = 'rgba(255,255,255,.25)';
  ctx.beginPath(); ctx.moveTo(xNow, gy0); ctx.lineTo(xNow, gy1); ctx.stroke();

  // Guides from circle projections toward graph values
  ctx.strokeStyle = 'rgba(170,160,255,.28)';
  ctx.beginPath(); ctx.moveTo(circleCX, projY); ctx.lineTo(xNow, ySinNow); ctx.stroke();

  ctx.strokeStyle = 'rgba(120,220,255,.28)';
  ctx.beginPath(); ctx.moveTo(projX, circleCY); ctx.lineTo(xNow, yCosNow); ctx.stroke();
  ctx.setLineDash([]);

  // Current dots on graph
  ctx.fillStyle = 'rgba(170,160,255,.95)';
  ctx.beginPath(); ctx.arc(xNow, ySinNow, 3.6, 0, Math.PI * 2); ctx.fill();

  ctx.fillStyle = 'rgba(120,220,255,.95)';
  ctx.beginPath(); ctx.arc(xNow, yCosNow, 3.6, 0, Math.PI * 2); ctx.fill();

  ctx.restore();
}
    if(type==='calc1'){
      const f=x=>0.6*Math.sin(x/40)+0.4*Math.cos(x/25);
      ctx.beginPath();for(let x=-W/2;x<W/2;x+=3){const y=80*f(x);ctx[x===-W/2?'moveTo':'lineTo'](x,y)}ctx.stroke();
      const a=-180,b=180,N=12, drift=((t%60)/60)*((b-a)/N);
      for(let i=0;i<N;i++){const x0=a+i*(b-a)/N+drift, x1=a+(i+1)*(b-a)/N+drift, xm=(x0+x1)/2;const y=80*f(xm);
        ctx.fillStyle='rgba(110,231,255,.18)';ctx.strokeStyle='rgba(110,231,255,.5)';ctx.beginPath();ctx.rect(x0,y,x1-x0,-y);ctx.fill();ctx.stroke()}
    }

    if(type==='calc2'){
      const k=3, phase=t*0.02, r=th=>100*(1+0.6*Math.sin(k*th+phase));
      ctx.beginPath();for(let th=0;th<=Math.PI*2;th+=0.02){const x=r(th)*Math.cos(th)*0.6,y=r(th)*Math.sin(th)*0.6;th===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.stroke();
      const sweep=((t%240)/240)*Math.PI*2;ctx.fillStyle='rgba(110,231,255,.14)';
      ctx.beginPath();ctx.moveTo(0,0);for(let th=0;th<=sweep;th+=0.02){const x=r(th)*Math.cos(th)*0.6,y=r(th)*Math.sin(th)*0.6;ctx.lineTo(x,y)}ctx.closePath();ctx.fill();
    }

    if(type==='calc3'){
      const zoom=1.22;function proj(x,y,z){return [zoom*(0.8*x+0.0*y),zoom*(0.35*y-0.7*z)]}
      ctx.strokeStyle='rgba(255,255,255,.25)';ctx.lineWidth=1.5;
      ctx.beginPath();let p=proj(0,0,0),px=proj(150,0,0),py=proj(0,120,0),pz=proj(0,0,120);ctx.moveTo(p[0],p[1]);ctx.lineTo(px[0],px[1]);ctx.moveTo(p[0],p[1]);ctx.lineTo(py[0],py[1]);ctx.moveTo(p[0],p[1]);ctx.lineTo(pz[0],pz[1]);ctx.stroke();
      const ax=0.035, ay=0.035;
      ctx.strokeStyle='rgba(142,197,255,.65)';ctx.lineWidth=1;
      for(let y=-100;y<=100;y+=12){ctx.beginPath();for(let x=-140;x<=140;x+=6){const z=40*Math.sin(ax*x)*Math.cos(ay*y);const q=proj(x,y,z);x===-140?ctx.moveTo(q[0],q[1]):ctx.lineTo(q[0],q[1])}ctx.stroke()}
      for(let x=-140;x<=140;x+=12){ctx.beginPath();for(let y=-100;y<=100;y+=6){const z=40*Math.sin(ax*x)*Math.cos(ay*y);const q=proj(x,y,z);y===-100?ctx.moveTo(q[0],q[1]):ctx.lineTo(q[0],q[1])}ctx.stroke()}
      const R=120;const sNow=(t%240)/240;ctx.strokeStyle='rgba(255,190,120,.95)';ctx.lineWidth=3;
      ctx.beginPath();for(let s=0;s<=sNow;s+=0.01){const th=s*2*Math.PI;const x=R*0.6*Math.cos(th),y=R*0.4*Math.sin(th);const z=40*Math.sin(ax*x)*Math.cos(ay*y);const q=proj(x,y,z);s===0?ctx.moveTo(q[0],q[1]):ctx.lineTo(q[0],q[1])}ctx.stroke();
      const th=sNow*2*Math.PI;const x=R*0.6*Math.cos(th),y=R*0.4*Math.sin(th);const z=40*Math.sin(ax*x)*Math.cos(ay*y);const q=proj(x,y,z);ctx.fillStyle='rgba(255,220,160,1)';ctx.beginPath();ctx.arc(q[0],q[1],4,0,6.283);ctx.fill();
    }

    if(type==='ode'){
      const gw=160, gh=100, cycle=300;
      if(!window._ode){window._ode={h:[],s:[],l:[],t0:0};for(let j=0;j<gh;j++){_ode.h[j]=[];_ode.s[j]=[];_ode.l[j]=[]}}
      const p=((t-_ode.t0)%cycle)/cycle;
      if(p<0.02){for(let j=0;j<gh;j++)for(let i=0;i<gw;i++){_ode.h[j][i]=Math.random()*360;_ode.s[j][i]=70+Math.random()*30;_ode.l[j][i]=45+Math.random()*20}}
      const Hh=_ode.h, Ss=_ode.s, Ll=_ode.l, alpha=0.015;
      for(let j=0;j<gh;j++){for(let i=0;i<gw;i++){let vx=0,vy=0,cnt=0;for(let dj=-1;dj<=1;dj++)for(let di=-1;di<=1;di++){const y=j+dj,x=i+di;if(y<0||y>=gh||x<0||x>=gw)continue;const ang=Hh[y][x]*Math.PI/180;vx+=Math.cos(ang);vy+=Math.sin(ang);cnt++}const ang=Math.atan2(vy/cnt,vx/cnt),deg=(ang*180/Math.PI+360)%360;Hh[j][i]=Hh[j][i]*(1-alpha)+deg*alpha;Ss[j][i]=Ss[j][i]*(1-alpha)+65*alpha;Ll[j][i]=Ll[j][i]*(1-alpha)+55*alpha}}
      const Wb=220,Hb=220,left=-Wb/2,top=-Hb/2,cw=Wb/gw,ch=Hb/gh;
      for(let j=0;j<gh;j++)for(let i=0;i<gw;i++){const h=Hh[j][i]|0,s=Ss[j][i]|0,l=Ll[j][i]|0;ctx.fillStyle='hsl('+h+','+s+'%,'+l+'%)';ctx.fillRect(left+i*cw,top+j*ch,cw+1,ch+1)}
      if(p>0.999)_ode.t0=t;
    }

    if(type==='linalg'){
      const a=1+0.4*Math.sin(t*0.02), b=0.6*Math.cos(t*0.015), c=0.3*Math.sin(t*0.017), d=1+0.3*Math.cos(t*0.018);
      function T(x,y){return [a*x+b*y,c*x+d*y]}
      const S=0.65;
      ctx.strokeStyle='rgba(142,197,255,.95)';ctx.lineWidth=1.5;
      for(let X=-W*1.6;X<=W*1.6;X+=26){ctx.beginPath();let first=true;for(let Y=-H*1.6;Y<=H*1.6;Y+=10){const p=T(X,Y);const px=p[0]*S,py=p[1]*S;first?(ctx.moveTo(px,py),first=false):ctx.lineTo(px,py)}ctx.stroke()}
      for(let Y=-H*1.6;Y<=H*1.6;Y+=26){ctx.beginPath();let first=true;for(let X=-W*1.6;X<=W*1.6;X+=10){const p=T(X,Y);const px=p[0]*S,py=p[1]*S;first?(ctx.moveTo(px,py),first=false):ctx.lineTo(px,py)}ctx.stroke()}
      function arrow(x0,y0,x1,y1){const ang=Math.atan2(y1-y0,x1-x0),len=10;ctx.beginPath();ctx.moveTo(x0,y0);ctx.lineTo(x1,y1);ctx.stroke();ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x1-len*Math.cos(ang-0.3),y1-len*Math.sin(ang-0.3));ctx.lineTo(x1-len*Math.cos(ang+0.3),y1-len*Math.sin(ang+0.3));ctx.closePath();ctx.fill()}
      ctx.strokeStyle='rgba(255,190,120,.95)';ctx.fillStyle='rgba(255,190,120,.95)';ctx.lineWidth=3;
      const e1=T(120,0),e2=T(0,120);arrow(0,0,e1[0]*S,e1[1]*S);arrow(0,0,e2[0]*S,e2[1]*S);
      ctx.fillStyle='rgba(255,220,170,1)';ctx.font='13px Space Grotesk';ctx.fillText('e₁',e1[0]*S+6,e1[1]*S+4);ctx.fillText('e₂',e2[0]*S+6,e2[1]*S+4);
    }

    if(type==='discrete'){
      if(!window._disc){
        const N=22,R=H/2.6,nodes=[];for(let i=0;i<N;i++){const ang=i/N*2*Math.PI;nodes.push([Math.cos(ang)*R,Math.sin(ang)*R])}
        const edges=[];for(let i=0;i<N;i++)edges.push([i,(i+1)%N]);for(let i=0;i<N;i++)for(let j=i+2;j<N;j++){if(Math.random()<0.45&&j!==i-1)edges.push([i,j])}
        let topIdx=0,minY=1e9;nodes.forEach((p,idx)=>{if(p[1]<minY){minY=p[1];topIdx=idx}});
        window._disc={N,nodes,edges,top:topIdx,step:0,tPick:0,path:[]}
      }
      const D=window._disc,{N,nodes,edges,top}=D;
      function bfs(s,tg){const adj=Array.from({length:N},()=>[]);for(const [i,j] of edges){adj[i].push(j);adj[j].push(i)}const q=[s],par=Array(N).fill(-1);par[s]=s;for(let qi=0;qi<q.length;qi++){const u=q[qi];if(u===tg)break;for(const v of adj[u])if(par[v]===-1){par[v]=u;q.push(v)}}if(par[tg]===-1)return [s,tg];const path=[];let cur=tg;while(cur!==par[cur]){path.push(cur);cur=par[cur]}path.push(s);path.reverse();return path}
      function newMultiPath(){
        const k=3+((Math.random()*2)|0), used=new Set([top]); let last=top; let full=[top];
        for(let i=0;i<k-1;i++){let nxt=(Math.random()*N)|0;let guard=0;while((used.has(nxt)||nxt===last)&&guard++<50){nxt=(Math.random()*N)|0}used.add(nxt);const seg=bfs(last,nxt);full=full.concat(seg.slice(1));last=nxt}
        const target=(Math.random()*N)|0; if(!used.has(target)){const seg=bfs(last,target);full=full.concat(seg.slice(1))}
        D.path=full;D.tPick=t
      }
      if(!D.path.length || (t-D.tPick)>35) newMultiPath();
      const speed=1.0, prog=Math.min(D.path.length-1,Math.floor((t-D.tPick)/speed));
      ctx.strokeStyle='rgba(142,197,255,.4)';ctx.lineWidth=1.5;ctx.beginPath();for(let i=0;i<=N;i++){const p=nodes[i%N];i===0?ctx.moveTo(p[0],p[1]):ctx.lineTo(p[0],p[1])}ctx.stroke();
      for(const [i,j] of edges){ctx.beginPath();ctx.moveTo(nodes[i][0],nodes[i][1]);ctx.lineTo(nodes[j][0],nodes[j][1]);ctx.stroke()}
      ctx.fillStyle='rgba(170,200,255,1)';for(const p of nodes){ctx.beginPath();ctx.arc(p[0],p[1],4,0,6.283);ctx.fill()}
      ctx.strokeStyle='rgba(255,200,130,.95)';ctx.lineWidth=3;ctx.beginPath();let p0=nodes[D.path[0]];ctx.moveTo(p0[0],p0[1]);
      for(let k=1;k<=prog;k++){const a=nodes[D.path[k-1]],b=nodes[D.path[k]];const mx=(a[0]+b[0])/2,my=(a[1]+b[1])/2-12;ctx.quadraticCurveTo(mx,my,b[0],b[1])}ctx.stroke();
      const sN=nodes[top];ctx.fillStyle='rgba(255,120,120,1)';ctx.beginPath();ctx.arc(sN[0],sN[1],5,0,6.283);ctx.fill();
      const eN=nodes[D.path[Math.min(prog,D.path.length-1)]];ctx.fillStyle='rgba(120,255,160,1)';ctx.beginPath();ctx.arc(eN[0],eN[1],5,0,6.283);ctx.fill();
    }

    if(type==='real'){
      const tallPhone=matchMedia('(max-width: 480px) and (orientation: portrait)').matches;
      ctx.save();ctx.translate(tallPhone?-8:-18,0);
      const A=x=>0.45*Math.abs(x);
      ctx.strokeStyle='rgba(255,130,150,.9)';ctx.lineWidth=2.2;
      ctx.beginPath();for(let x=-W/2;x<=W/2;x+=2){const y=A(x);x===-W/2?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.stroke();
      ctx.beginPath();for(let x=-W/2;x<=W/2;x+=2){const y=-A(x);x===-W/2?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.stroke();
      ctx.fillStyle='rgba(110,231,255,.08)';
      ctx.beginPath();ctx.moveTo(-W/2,A(-W/2));for(let x=-W/2;x<=W/2;x+=2){ctx.lineTo(x,A(x))}for(let x=W/2;x>=-W/2;x-=2){ctx.lineTo(x,-A(x))}ctx.closePath();ctx.fill();
      const phase=t*0.035, k=1420, c=40;
      ctx.strokeStyle='rgba(120,200,255,1)';ctx.lineWidth=2.2;
      ctx.beginPath();
      for(let x=-W/2;x<=W/2;x+=1.25){
        const ax=A(x);
        const freq=k/(Math.abs(x)+c);
        const y=ax*Math.sin(freq+phase);
        if(x===-W/2)ctx.moveTo(x,y);else ctx.lineTo(x,y)
      }
      ctx.stroke();
      ctx.restore();
    }

      ctx.restore(); animRAF=requestAnimationFrame(draw);
    }
    draw();
  }

  // soft cursor trail
  const cursor=document.getElementById('cursor'); let cx=0,cy=0,tx=0,ty=0;
  function loop(){ cx+=(tx-cx)*0.18; cy+=(ty-cy)*0.18; cursor.style.left=cx+'px'; cursor.style.top=cy+'px'; requestAnimationFrame(loop) }
  loop(); addEventListener('mousemove',e=>{tx=e.clientX; ty=e.clientY});

  // footer year + rveals
  document.getElementById('year').textContent=new Date().getFullYear();
  const obs=new IntersectionObserver(es=>{for(const e of es){if(e.isIntersecting)e.target.classList.add('on')}},{threshold:.15});
  for(const el of document.querySelectorAll('.reveal')) obs.observe(el);
  </script>
</body>
</html>
